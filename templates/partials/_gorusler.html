{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/base_css/_gorusler.css' %}">
{% endblock %}

{% block content %}
<section class="anim-sol">
<div class="container-fluid gorusler-wrapper">
  <div class="row">
    <div class="col-12 col-lg-3 slider-hizlama">
      
    </div>

    <div class="col-12 col-lg-9 slider-hizlama">
      <div class="row gorusler-logo-slogan align-items-center">
        <div class="col-12 col-md-6 gorusler-logo-baslik_wrapper anim-giris anim-sol">
          <div class="logo-container">
            <img src="{% static 'img/grilogo.svg' %}" alt="Logo" class="logo-img">
          </div>
          <span class="gorusler-logo-title">DEĞERLİ GÖRÜŞLER</span>
        </div>
        <div class="col-12 col-md-6 gorusler-baslik-slogan anim-giris anim-sag">
          <span class="gorusler-slogan-text">Müşterilerimizin geri bildirimleri, mükemmeliyet anlayışımızı şekillendiriyor. Deneyimlerini okuyun ve Akliva’nın inşaat sektöründe neden güvenilen bir isim olduğunu keşfedin.</span>
        </div>
      </div>

      <div class="slider-progress-wrapper">
        <div class="buyuk-slider-container anim-giris anim-sol">
          <div class="buyuk-slider-card" id="buyukKart"></div>
        </div>

        <div class="kucuk-slider-wrapper">
          <div class="kusuk-slider-card-scroll" id="kucukSlider"></div>

          <div class="progress-arrows progress-desktop">
            <div class="progress-bar">
              <div class="progress-bar-fill"></div>
            </div>

              <svg id="solOk1" class="slider-arrow prev" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path class="arrow-shape"d="M20.8077 11.0762C20.492 11.0762 20.1892 11.2022 19.966 11.4265L14.0386 17.3832C13.9275 17.4939 13.8393 17.6257 13.7792 17.7708C13.719 17.916 13.688 18.0717 13.688 18.229C13.688 18.3863 13.719 18.542 13.7792 18.6872C13.8393 18.8323 13.9275 18.9641 14.0386 19.0748L19.966 25.0315C20.0762 25.1431 20.2073 25.2318 20.3518 25.2922C20.4962 25.3527 20.6512 25.3839 20.8077 25.3839C20.9642 25.3839 21.1191 25.3527 21.2636 25.2922C21.408 25.2318 21.5391 25.1431 21.6493 25.0315C21.7605 24.9207 21.8486 24.789 21.9088 24.6438C21.969 24.4986 22 24.3429 22 24.1856C22 24.0284 21.969 23.8726 21.9088 23.7275C21.8486 23.5823 21.7605 23.4505 21.6493 23.3398L16.5518 18.229L21.6493 13.1182C21.8726 12.8939 21.998 12.5896 21.998 12.2724C21.998 11.9551 21.8726 11.6509 21.6493 11.4265C21.4261 11.2022 21.1234 11.0762 20.8077 11.0762Z" fill="currentColor"/>
                <circle cx="18" cy="18" r="17" transform="matrix(-1 0 0 1 36 0)" stroke="#B1B1B1" stroke-width="2"/>
              </svg>

              <svg id="sagOk1" class="slider-arrow next" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g transform="scale(-1,1) translate(-36,0)">
                <path class="arrow-shape" d="M20.8077 11.0762C20.492 11.0762 20.1892 11.2022 19.966 11.4265L14.0386 17.3832C13.9275 17.4939 13.8393 17.6257 13.7792 17.7708C13.719 17.916 13.688 18.0717 13.688 18.229C13.688 18.3863 13.719 18.542 13.7792 18.6872C13.8393 18.8323 13.9275 18.9641 14.0386 19.0748L19.966 25.0315C20.0762 25.1431 20.2073 25.2318 20.3518 25.2922C20.4962 25.3527 20.6512 25.3839 20.8077 25.3839C20.9642 25.3839 21.1191 25.3527 21.2636 25.2922C21.408 25.2318 21.5391 25.1431 21.6493 25.0315C21.7605 24.9207 21.8486 24.789 21.9088 24.6438C21.969 24.4986 22 24.3429 22 24.1856C22 24.0284 21.969 23.8726 21.9088 23.7275C21.8486 23.5823 21.7605 23.4505 21.6493 23.3398L16.5518 18.229L21.6493 13.1182C21.8726 12.8939 21.998 12.5896 21.998 12.2724C21.998 11.9551 21.8726 11.6509 21.6493 11.4265C21.4261 11.2022 21.1234 11.0762 20.8077 11.0762Z" fill="currentColor"/>
                <circle cx="18" cy="18" r="17" stroke="#B1B1B1" stroke-width="2"/>
                </g>
              </svg>
              
           {% comment %}  <img src="{% static 'img/griSolOk.png' %}" alt="Sol Ok" class="arrow prev" id="solOk1">
            <img src="{% static 'img/griSagOk.png' %}" alt="Sağ Ok" class="arrow next" id="sagOk1"> {% endcomment %}
            
          </div>


        </div>
            <div class="progress-arrows progress-mobile">
              <div class="progress-bar">
                <div class="progress-bar-fill"></div>
              </div>
              
              <svg id="solOkMobile" class="slider-arrow prev" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path class="arrow-shape" d="M20.8077 11.0762C20.492 11.0762 20.1892 11.2022 19.966 11.4265L14.0386 17.3832C13.9275 17.4939 13.8393 17.6257 13.7792 17.7708C13.719 17.916 13.688 18.0717 13.688 18.229C13.688 18.3863 13.719 18.542 13.7792 18.6872C13.8393 18.8323 13.9275 18.9641 14.0386 19.0748L19.966 25.0315C20.0762 25.1431 20.2073 25.2318 20.3518 25.2922C20.4962 25.3527 20.6512 25.3839 20.8077 25.3839C20.9642 25.3839 21.1191 25.3527 21.2636 25.2922C21.408 25.2318 21.5391 25.1431 21.6493 25.0315C21.7605 24.9207 21.8486 24.789 21.9088 24.6438C21.969 24.4986 22 24.3429 22 24.1856C22 24.0284 21.969 23.8726 21.9088 23.7275C21.8486 23.5823 21.7605 23.4505 21.6493 23.3398L16.5518 18.229L21.6493 13.1182C21.8726 12.8939 21.998 12.5896 21.998 12.2724C21.998 11.9551 21.8726 11.6509 21.6493 11.4265C21.4261 11.2022 21.1234 11.0762 20.8077 11.0762Z" fill="currentColor"/>
                <circle cx="18" cy="18" r="17" transform="matrix(-1 0 0 1 36 0)" stroke="#B1B1B1" stroke-width="2"/>
              </svg>
              
              <svg id="sagOkMobile" class="slider-arrow next" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g transform="scale(-1,1) translate(-36,0)">
                <path class="arrow-shape" d="M20.8077 11.0762C20.492 11.0762 20.1892 11.2022 19.966 11.4265L14.0386 17.3832C13.9275 17.4939 13.8393 17.6257 13.7792 17.7708C13.719 17.916 13.688 18.0717 13.688 18.229C13.688 18.3863 13.719 18.542 13.7792 18.6872C13.8393 18.8323 13.9275 18.9641 14.0386 19.0748L19.966 25.0315C20.0762 25.1431 20.2073 25.2318 20.3518 25.2922C20.4962 25.3527 20.6512 25.3839 20.8077 25.3839C20.9642 25.3839 21.1191 25.3527 21.2636 25.2922C21.408 25.2318 21.5391 25.1431 21.6493 25.0315C21.7605 24.9207 21.8486 24.789 21.9088 24.6438C21.969 24.4986 22 24.3429 22 24.1856C22 24.0284 21.969 23.8726 21.9088 23.7275C21.8486 23.5823 21.7605 23.4505 21.6493 23.3398L16.5518 18.229L21.6493 13.1182C21.8726 12.8939 21.998 12.5896 21.998 12.2724C21.998 11.9551 21.8726 11.6509 21.6493 11.4265C21.4261 11.2022 21.1234 11.0762 20.8077 11.0762Z" fill="currentColor"/>
                <circle cx="18" cy="18" r="17" stroke="#B1B1B1" stroke-width="2"/>
                </g>
              </svg>
            

            {% comment %}    <img src="{% static 'img/griSolOk.png' %}" alt="Sol Ok" class="arrow prev" id="solOkMobile">
              <img src="{% static 'img/griSagOk.png' %}" alt="Sağ Ok" class="arrow next" id="sagOkMobile"> {% endcomment %}
            
            
            </div>


        
      </div>
    </div>
  </div>
</div>
</section>
{% endblock %}

{% block extra_js %}
<script type="application/json" id="gorusler-json">
  {{ gorusler_json|safe }}
</script>

<script>
document.addEventListener("DOMContentLoaded", function () {

  const buyukKart = document.getElementById("buyukKart");
  const kucukSlider = document.getElementById("kucukSlider");
  const nextBtn = document.getElementById("sagOk1");
  const prevBtn = document.getElementById("solOk1");
  const progressFills = document.querySelectorAll(".progress-bar-fill");
  const gorusler = JSON.parse(document.getElementById("gorusler-json").textContent);
  const toplamKartSayisi = gorusler.length;

  let aktifIndex = 0;
  let silinenKartlar = [];

  function kisaMesaj(metin, limit = 100) {
    return metin.length > limit ? metin.slice(0, limit) + "..." : metin;
  }

  function updateProgressBar() {
  const oran = ((aktifIndex + 1) / toplamKartSayisi) * 100;
  document.querySelectorAll(".progress-bar-fill").forEach(fill => {
    fill.style.width = `${oran}%`;
  });
}

  function renderBuyukKart(index) {
    const item = gorusler[index];
    buyukKart.innerHTML = `
      <img src="{% static 'img/gorusler-personel-sari.svg' %}" class="personel-img">
      <div class="ad">${item.ad}</div>
      <div class="meslek-sehir">${item.meslek} • ${item.sehir}</div>
      <div class="yildizlar">${renderYildiz(item.yildiz_sayisi)}</div>
      <div class="mesaj">${kisaMesaj(item.mesaj)}</div>
      <div class="tarih">${item.tarih}</div>
    `;
  }

  function renderYildiz(sayi) {
    let html = "";
    for (let i = 1; i <= 5; i++) {
      const src = i <= sayi ? "{% static 'img/sari-yildiz.svg' %}" : "{% static 'img/sari-yildiz1.svg' %}";
      html += `<img src="${src}" alt="Yıldız">`;
    }
    return html;
  }

  function renderKucukKart(item) {
    const div = document.createElement("div");
    div.className = "kucuk-card";
    div.innerHTML = `
      <img src="{% static 'img/gorusler-person-gri.svg' %}" class="person">
      <div class="ad">${item.ad}</div>
      <div class="meslek-sehir">${item.meslek} • ${item.sehir}</div>
      <div class="yildizlar">${renderYildiz(item.yildiz_sayisi)}</div>
      <div class="mesaj">${kisaMesaj(item.mesaj)}</div>
      <div class="tarih">${item.tarih}</div>
    `;
    return div;
  }

  gorusler.slice(1).forEach(item => {
    kucukSlider.appendChild(renderKucukKart(item));
  });

  nextBtn.addEventListener("click", () => {
    const kucukKartlar = kucukSlider.querySelectorAll(".kucuk-card");
    if (aktifIndex < gorusler.length - 1 && kucukKartlar.length > 0) {
      const silinecek = kucukKartlar[0];
      silinecek.classList.add("kaybol");

      setTimeout(() => {
        silinenKartlar.push(silinecek);
        kucukSlider.removeChild(silinecek);
        aktifIndex++;
        renderBuyukKart(aktifIndex);
        updateProgressBar();
      }, 0); //animasytonun 300 dü gçeiş değeri istenmediği için sıfırladım 
    }
  });

  prevBtn.addEventListener("click", () => {
    if (aktifIndex > 0 && silinenKartlar.length > 0) {
      const geriKart = silinenKartlar.pop();
      geriKart.classList.add("kaybol");
      kucukSlider.insertBefore(geriKart, kucukSlider.firstChild);

      void geriKart.offsetWidth;

      setTimeout(() => {
        geriKart.classList.remove("kaybol");
      }, 0); //animasytonun 300 dü gçeiş değeri istenmediği için sıfırladım 

      aktifIndex--;
      renderBuyukKart(aktifIndex);
      updateProgressBar();
    }
  });

  // Mobil oklar için yönlendirme
  document.getElementById("sagOkMobile")?.addEventListener("click", () => {
    nextBtn.click();
  });

  document.getElementById("solOkMobile")?.addEventListener("click", () => {
    prevBtn.click();
  });

  // Başlangıçta büyük kartı ve progress bar'ı yükle
  renderBuyukKart(0);
  updateProgressBar();

  // ✅ Sadece mobilde test için aktifIndex = 2 yap
  if (window.innerWidth <= 992) {
    aktifIndex = 2;
    renderBuyukKart(aktifIndex);
    updateProgressBar();
  }
});
</script>
{% endblock %}
