{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/base_css/_projeler.css' %}">
{% endblock %}

<section id="projects-section" class="pt-5 anim-giris anim-sol">
  <div class="container-fluid position-relative">
     
    <div class="row">
      
      <!-- Sütun 1: arkaplan siyah -->
      <div class="col-12 col-lg-3">
        
      </div>

      <!-- Sütun 2: Başlık ve açıklama -->
      <div class="col-12 col-lg-3 content-col">
        <!-- Satır 1: Logo + Başlık -->
        <div class="d-flex align-items-center mb-4">
            <div class="logo-glow-wrapper position-relative d-inline-block">
              <img src="{% static 'img/grilogo.png' %}" alt="Logo" class="logo-glow-image me-1 fixed-logo-size">
            </div>
            <h2 class="fw-bold fs-4 m-0">PROJELER</h2>
          </div>

          <!-- Satır 2: Slogan 1 -->
          <div class="mb-3" style="margin-top: 5rem;">
            <h3 class="slogan-1 anim-giris anim-sag">
              Güvenle Yükselen <br> Projeler, Hayallerinize <br>Değer Katıyoruz.
            </h3>
          </div>

          <!-- Satır 3: Slogan 2 -->
          <div>
            <p class="slogan-2 anim-alt anim-sag">
              Yaşam alanlarınızı modern mimari<br>ve sağlam yapılarla buluşturuyoruz
            </p>
          </div>
      </div>

      <!-- Sütun 3: Slider -->
      <div class="col-12 col-lg-6 slider-col d-flex flex-column align-items-start "> 
 
                  <!-- Açıklama -->
                    <span class="slider-description anim-sag anim-giris">
                        Aktiva, mükemmeliyet, dürüstlük ve sürdürülebilir büyüme <br>
                        anlayışıyla hareket eder. Misyonumuz, zamanın testine <br>
                        dayanacak yüksek kaliteli inşaat çözümleri sunmaktır.
                    </span>
        <div class="slider-content-wrapper">
          
        

          <!-- Slider -->
          <div class="slider-wrapper position-relative overflow-hidden ms-auto">
            <div class="slider-track d-flex">

              {% for i in slider_ids %}
              <div class="project-card position-relative">
                

                <!-- Proje Görseli -->
                <img src="{% static 'img/slider' %}{{ i }}.jpg" alt="Proje {{ i }}" class="project-image">

                <!-- Bilgilendirici Notlar -->
                <div class="project-info-overlay">
                  <!-- Üst Sol: Konum -->
                  <div class="project-location">
                    <img src="{% static 'img/projeler-konum.png' %}" alt="Konum" class="icon">
                    <span>Karatay / Konya</span>
                  </div>

                  <!-- Alt Bilgiler -->
                  <h4 class="project-title">Revapark Konakları</h4>

                  <div class="project-info-lines">
                    
                    <!-- Satır 1: Başlangıç + Daire -->
                    <div class="info-line">
                      <img src="{% static 'img/takvim-ikonu.png' %}" alt="Başlangıç" class="icon">
                      <span>01.01.2024</span>
                      <img src="{% static 'img/daire-ikonu.png' %}" alt="Daire" class="icon ms-3">
                      <span>100 Daire</span>
                    </div>

                    <!-- Satır 2: Bitiş + Dükkan -->
                    <div class="info-line">
                      <img src="{% static 'img/takvim-ikonu.png' %}" alt="Bitiş" class="icon">
                      <span>01.01.2024</span>
                      <img src="{% static 'img/dukkan-ikonu.png' %}" alt="Dükkan" class="icon ms-3">
                      <span>20 Dükkan</span>
                    </div>
                  </div>
                </div>

                <!-- Sağ Alt Buton -->
                <a href="#" class="project-button">PROJEYİ İNCELE</a>
              </div>
              {% endfor %}
            </div>
          </div>

          <!-- İlerleme ve Oklar -->
          <div class="d-flex align-items-center justify-content-start gap-3 w-100 pt-4 progress-and-arrows-group">
            {% comment %} <span class="fw-bold" id="current-index-info">1 / 5</span> {% endcomment %}

            <div class="d-flex align-items-center gap-3 flex-grow-1">
              <div class="custom-progress-bar">
                <div class="progress-indicator" id="progress-indicator" style="width: 20%;"></div>
              </div>

             {% comment %} <img src="{% static 'img/griSolOk.svg' %}" alt="Sol Ok" class="slider-arrow prev" id="solOk"> {% endcomment %}
            {% comment %} <img src="{% static 'img/griSagOk.svg' %}" alt="Sağ Ok" class="slider-arrow next" id="sagOk"> {% endcomment %}

              <svg id="solOk" class="slider-arrow prev" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path class="arrow-shape" d="M20.8077 11.0762C20.492 11.0762 20.1892 11.2022 19.966 11.4265L14.0386 17.3832C13.9275 17.4939 13.8393 17.6257 13.7792 17.7708C13.719 17.916 13.688 18.0717 13.688 18.229C13.688 18.3863 13.719 18.542 13.7792 18.6872C13.8393 18.8323 13.9275 18.9641 14.0386 19.0748L19.966 25.0315C20.0762 25.1431 20.2073 25.2318 20.3518 25.2922C20.4962 25.3527 20.6512 25.3839 20.8077 25.3839C20.9642 25.3839 21.1191 25.3527 21.2636 25.2922C21.408 25.2318 21.5391 25.1431 21.6493 25.0315C21.7605 24.9207 21.8486 24.789 21.9088 24.6438C21.969 24.4986 22 24.3429 22 24.1856C22 24.0284 21.969 23.8726 21.9088 23.7275C21.8486 23.5823 21.7605 23.4505 21.6493 23.3398L16.5518 18.229L21.6493 13.1182C21.8726 12.8939 21.998 12.5896 21.998 12.2724C21.998 11.9551 21.8726 11.6509 21.6493 11.4265C21.4261 11.2022 21.1234 11.0762 20.8077 11.0762Z" fill="currentColor"/>
                <circle cx="18" cy="18" r="17" transform="matrix(-1 0 0 1 36 0)" stroke="#B1B1B1" stroke-width="2"/>
              </svg>

              <svg id="sagOk" class="slider-arrow next" width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g transform="scale(-1,1) translate(-36,0)">
                <path class="arrow-shape" d="M20.8077 11.0762C20.492 11.0762 20.1892 11.2022 19.966 11.4265L14.0386 17.3832C13.9275 17.4939 13.8393 17.6257 13.7792 17.7708C13.719 17.916 13.688 18.0717 13.688 18.229C13.688 18.3863 13.719 18.542 13.7792 18.6872C13.8393 18.8323 13.9275 18.9641 14.0386 19.0748L19.966 25.0315C20.0762 25.1431 20.2073 25.2318 20.3518 25.2922C20.4962 25.3527 20.6512 25.3839 20.8077 25.3839C20.9642 25.3839 21.1191 25.3527 21.2636 25.2922C21.408 25.2318 21.5391 25.1431 21.6493 25.0315C21.7605 24.9207 21.8486 24.789 21.9088 24.6438C21.969 24.4986 22 24.3429 22 24.1856C22 24.0284 21.969 23.8726 21.9088 23.7275C21.8486 23.5823 21.7605 23.4505 21.6493 23.3398L16.5518 18.229L21.6493 13.1182C21.8726 12.8939 21.998 12.5896 21.998 12.2724C21.998 11.9551 21.8726 11.6509 21.6493 11.4265C21.4261 11.2022 21.1234 11.0762 20.8077 11.0762Z"  fill="currentColor"/>
                <circle cx="18" cy="18" r="17" stroke="#B1B1B1" stroke-width="2"/>
                </g>
              </svg>

            </div>
          </div>

          <!-- Filtreler -->
          <div id="project-filter">
            <a href="#" class="filter-link active">Tüm Projeler</a>
            <a href="#" class="filter-link">Devam Eden Projeler</a>
            <a href="#" class="filter-link">Tamamlanan Projeler</a>
          </div>
        </div>
      </div>
      <!-- /Sütun 3: Slider -->
    </div>

     
  </div>
    <div class="bottom-divider-wrapper-projeler">
      <div class="bottom-divider-line-projeler"></div>
    </div>   
</section>




{% block extra_js %}
<script>
(function () {
  const CARD_WIDTH = 610;
  const GAP = 45;
  const DESIRED_VISIBLE_COUNT = 1.65;

  function getVisibleCardCount() {
    return window.innerWidth >= 992 ? DESIRED_VISIBLE_COUNT : 1;
  }

  function calculateStep(cards) {
    if (window.innerWidth >= 992) {
      return CARD_WIDTH + GAP;
    } else {
      const firstCard = cards?.[0];
      return firstCard ? firstCard.getBoundingClientRect().width + GAP : 0;
    }
  }
function calculateOffset(cards, index) {
  let offset = 0;
  for (let i = 0; i < index; i++) {
    offset += cards[i].getBoundingClientRect().width + GAP;
  }
  return offset;
}
 function updateSlider(state) {
  const { wrapper, track, cards, cardCount, leftBtn, rightBtn, progressIndicator, currentIndexInfo } = state.elements;
  const visibleCount = getVisibleCardCount();
  const step = calculateStep(cards);

  let { currentIndex } = state;
  const wrapperWidth = wrapper.getBoundingClientRect().width;
  const trackWidth = track.scrollWidth;

  let actualMaxIndex, totalSteps, offset;

  if (window.innerWidth >= 992) {
    actualMaxIndex = Math.floor(cardCount - visibleCount);
    totalSteps = Math.max(1, actualMaxIndex + 1);
    currentIndex = Math.max(0, Math.min(currentIndex, actualMaxIndex));
    offset = currentIndex >= actualMaxIndex ? -(trackWidth - wrapperWidth) : -(currentIndex * step);
  } else {
    actualMaxIndex = cardCount - 1;
    totalSteps = cardCount;
    currentIndex = Math.max(0, Math.min(currentIndex, actualMaxIndex));

    // ✅ Mobilde offset doğrudan kartın konumuna göre hesaplanır
    const targetCard = cards[currentIndex];
    offset = targetCard ? -targetCard.offsetLeft : 0;
  }

  track.style.transform = `translateX(${offset}px)`;
  state.currentIndex = currentIndex;

  cards.forEach(card => card.classList.remove('current-active'));
  if (cards[currentIndex]) cards[currentIndex].classList.add('current-active');

  if (leftBtn) leftBtn.disabled = currentIndex === 0;
  if (rightBtn) rightBtn.disabled = currentIndex >= actualMaxIndex;

  if (progressIndicator && totalSteps > 0) {
    const progressPercent = ((currentIndex + 1) / totalSteps) * 100;
    progressIndicator.style.width = `${progressPercent}%`;
  }

  if (currentIndexInfo) {
    currentIndexInfo.textContent = `${currentIndex + 1} / ${Math.max(1, totalSteps)}`;
  }
}


  function initProjectSlider() {
    const elements = {
      wrapper: document.querySelector(".slider-wrapper"),
      track: document.querySelector(".slider-track"),
      leftBtn: document.getElementById("solOk"),
      rightBtn: document.getElementById("sagOk"),
      progressIndicator: document.getElementById("progress-indicator"),
      currentIndexInfo: document.getElementById("current-index-info"),
      cards: null,
      cardCount: 0
    };

    elements.cards = elements.track?.querySelectorAll(".project-card") || [];
    if (!elements.cards.length || !elements.wrapper || !elements.track) return;

    elements.cardCount = elements.cards.length;

   let trackWidth;
if (window.innerWidth >= 992) {
  trackWidth = (CARD_WIDTH * elements.cardCount) + (GAP * (elements.cardCount - 1));
  elements.cards.forEach(card => {
    card.style.minWidth = `${CARD_WIDTH}px`;
  });
} else {
  const cardWidths = Array.from(elements.cards).map(card => card.getBoundingClientRect().width);
  const totalCardWidth = cardWidths.reduce((sum, w) => sum + w, 0);
  trackWidth = totalCardWidth + (GAP * (elements.cardCount - 1));
}
elements.track.style.width = `${trackWidth}px`;

    const state = {
      currentIndex: 0,
      elements: elements
    };

    if (elements.rightBtn) {
      elements.rightBtn.addEventListener("click", () => {
        const maxIndex = window.innerWidth >= 992
          ? Math.floor(elements.cardCount - getVisibleCardCount())
          : elements.cardCount - 1;
        if (state.currentIndex < maxIndex) {
          state.currentIndex++;
          updateSlider(state);
        }
      });
    }

    if (elements.leftBtn) {
      elements.leftBtn.addEventListener("click", () => {
        if (state.currentIndex > 0) {
          state.currentIndex--;
          updateSlider(state);
        }
      });
    }

    window.addEventListener("resize", () => {
      setTimeout(() => {
        const visibleCount = getVisibleCardCount();
        const newMaxIndex = window.innerWidth >= 992
          ? Math.floor(elements.cardCount - visibleCount)
          : elements.cardCount - 1;
        state.currentIndex = Math.max(0, Math.min(state.currentIndex, newMaxIndex));
        updateSlider(state);
      }, 100);
    });

    updateSlider(state);
  }

  function initFilterLinks() {
    document.querySelectorAll('.filter-link').forEach(link => {
      link.addEventListener('click', function (e) {
        e.preventDefault();
        document.querySelectorAll('.filter-link').forEach(l => l.classList.remove('active'));
        this.classList.add('active');
      });
    });
  }

  document.addEventListener("DOMContentLoaded", function () {
    initProjectSlider();
    initFilterLinks();
  });
})();

</script>
{% endblock %}